import{_ as w,Z as f,aa as g,a8 as d,a0 as y,a1 as b,a2 as v,ad as r,d as i,ah as p,a3 as c,as as x,b2 as S,ae as u,ak as U}from"./index.58c24f9b.js";import{u as V,g as m,p as k,r as E}from"./generateHeaders.1afc8456.js";import{u as h}from"./auth_user_store.67764a02.js";import"./axios.5abb35e7.js";const{getSettings:q}=f(V()),{setAuthUserDetails:A,setUserDetails:D}=h(),{getAuthUserDetails:N}=f(h()),C={data(){return{form:{email:null,password:null},show_password:{password:!1}}},computed:{encryptionEnabled(){var e;return(e=q.value)==null?void 0:e.api_encryption_enabled},getAuthUserDetails(){return N.value}},mounted(){},methods:{async login(){try{let e={...this.form};this.encryptionEnabled&&(e=g(JSON.stringify(e)));let o=(await this.$api.post("/api/v1/auth/login/",e,{headers:{...m()}})).data;this.encryptionEnabled&&(o=JSON.parse(d(o)));const{message:l,success:t,results:n}=o;k({message:l}),await A(n),await this.fetchMe(),this.$router.push("/").then(()=>{this.$router.go()})}catch(e){E({caller:"Login form",error:e,api_encryption_enabled:this.api_encryption_enabled})}},async fetchMe(){try{if(!this.getAuthUserDetails.id)return;const e={id:this.getAuthUserDetails.id};let o=(await this.$api.get("/api/v1/users/me/",{headers:{...m()},params:e})).data;this.encryptionEnabled&&(o=JSON.parse(d(o)));const{message:l,success:t,results:n}=o;D(n)}catch(e){console.log("Fetch one user error: ",e)}}}},B={class:"form-container"},J=r("div",{class:"text-center text-h6 q-mb-md text-weight-bold"},"Login",-1),L={class:"q-py-xs"},M=r("div",{class:"form-lable"},"Email *",-1),O={class:"q-py-xs"},Q=r("div",{class:"form-lable"},"Password",-1),I={class:"q-my-sm"},P={class:"flex justify-between q-mt-md"};function R(e,s,o,l,t,n){const _=y("router-link");return b(),v("div",B,[J,r("form",{onSubmit:s[4]||(s[4]=U((...a)=>n.login&&n.login(...a),["prevent"]))},[r("div",L,[M,i(p,{dense:"",outlined:"",modelValue:t.form.email,"onUpdate:modelValue":s[0]||(s[0]=a=>t.form.email=a)},null,8,["modelValue"])]),r("div",O,[Q,i(p,{dense:"",outlined:"",modelValue:t.form.password,"onUpdate:modelValue":s[2]||(s[2]=a=>t.form.password=a),type:t.show_password.password?"text":"password"},{append:c(()=>[i(x,{name:t.show_password.password?"visibility":"visibility_off",size:"30px",color:"grey",class:"q-mr-sm",onClick:s[1]||(s[1]=a=>t.show_password.password=!t.show_password.password)},null,8,["name"])]),_:1},8,["modelValue","type"])]),r("div",I,[i(_,{to:"/register/user-type",class:"no-link-decoration"},{default:c(()=>[S("Register")]),_:1})]),r("div",P,[i(u,{outline:"",label:"Cancel",onClick:s[3]||(s[3]=a=>e.$router.go(-1)),"no-caps":""}),i(u,{outline:"",label:"Submit",type:"submit","no-caps":""})])],32)])}var H=w(C,[["render",R]]);export{H as default};
