import{Q as y}from"./QSelect.1fc42082.js";import{_ as J,Z as j,a8 as E,aa as P,a1 as m,a2 as u,ad as o,d as n,ai as f,a5 as h,ah as d,aj as B,J as b,af as p,ae as O,ak as C}from"./index.56aced16.js";import{u as D}from"./index.62701558.js";import{c as _,r as c}from"./index.33746749.js";import{u as G,g as Q,p as W,r as L}from"./generateHeaders.891fe619.js";import{u as T}from"./auth_user_store.0a1df304.js";import"./QItemLabel.cffd16e9.js";import"./QMenu.58a91336.js";import"./position-engine.9dfbd25a.js";import"./selection.e4c60947.js";import"./format.a33550d6.js";import"./axios.af9b5afd.js";const{getSettings:A}=j(G()),{getMe:I}=j(T()),R={props:{details:{type:[String,Object]}},setup(){return{v$:D()}},data(){return{form:{school:null,number_of_classes:void 0,number_of_students_per_class:void 0,number_of_teachers:void 0,school_has_labs:!1,number_of_labs:void 0,student_gender:null,number_of_boys_toilets:void 0,number_of_girls_toilets:void 0,number_of_teachers_toilets:void 0,school_has_water_source:!1,types_of_water_sources:null,number_of_desks:void 0,number_of_chairs:void 0,number_of_lockers:void 0},school_list:[]}},validations(){return{form:{school:{required:_.withMessage("School is required",c)},number_of_classes:{required:_.withMessage("Number of classes is required",c)},number_of_students_per_class:{required:_.withMessage("Number of students per class is required",c)},number_of_teachers:{required:_.withMessage("Number of teachers is required",c)},number_of_teachers_toilets:{required:_.withMessage("Number of teachers is required",c)},number_of_teachers_toilets:{required:_.withMessage("Number of teachers toilets is required",c)},student_gender:{required:_.withMessage("Student gender composition is required",c)}}}},computed:{encryptionEnabled(){var l;return(l=A.value)==null?void 0:l.api_encryption_enabled},PrimarySchools(){return this.school_list.map(l=>({label:l.name_of_school,value:l.school_serial_number,id:l.id}))},schoolHasGirls(){return this.form.student_gender==="girls"||this.form.student_gender==="mixed"?!0:(this.form.number_of_girls_toilets=void 0,!1)},schoolHasBoys(){return this.form.student_gender==="boys"||this.form.student_gender==="mixed"?!0:(this.form.number_of_boys_toilets=void 0,!1)},waterSources(){return["borehole","well","spring","piped water"]}},watch:{details:{immediate:!0,handler(l){var e,a,t;if(!!l)for(const[s,i]of Object.entries(this.form))this.form[s]=this.details[s]||i,s==="school"&&(this.form[s]={label:(e=this.details.school)==null?void 0:e.name_of_school,value:(a=this.details.school)==null?void 0:a.school_serial_number,...(t=this.details)==null?void 0:t.school})}}},mounted(){this.fetchSchools()},methods:{handleSchoolHasLab(l){l||(this.form.number_of_labs=void 0)},handleSchoolHasWaterSource(l){l||(this.form.type_of_water_source=null)},async fetchSchools(l={}){try{let a=(await this.$api.get("/api/v1/school-heads/schools-list/",{headers:{...Q()}})).data;this.encryptionEnabled&&(a=JSON.parse(E(a)));const{message:t,success:s,results:i}=a;this.school_list=i}catch{}},async submit(){var l;try{if(this.v$.$touch(),this.v$.$error)return;let e={...this.form};e.school_serial_number=this.form.school.value,e.school=this.form.school.id,e.current_school_head=(l=I.value)==null?void 0:l.id,e.name_of_school=this.form.school.label,e.type_of_school="primary",this.encryptionEnabled&&(e=P(JSON.stringify(e)));let t=(await this.$api.post("/api/v1/school-heads/schools/update/",e,{headers:{...Q()}})).data;this.encryptionEnabled&&(t=JSON.parse(E(t)));const{message:s,success:i,results:v}=t;W({message:s})}catch(e){L({caller:"update school details form",error:e,api_encryption_enabled:this.encryptionEnabled})}}}},Z={class:"form-container"},z=o("div",{class:"text-h6 text-center"},"Primary school ",-1),F={class:"row"},K={class:"col-md-6 col-xs-12 q-pa-sm"},X={class:"q-my-xs"},Y=o("div",{class:"form-lable"},"School *",-1),$={key:0,class:"text-red"},ee={class:"q-my-xs"},se=o("div",{class:"form-lable"},"Number of classes *",-1),oe={key:0,class:"text-red"},re={class:"q-my-xs"},te=o("div",{class:"form-lable"},"Number of students per class *",-1),le={key:0,class:"text-red"},ne={class:"q-my-xs"},ie=o("div",{class:"form-lable"},"Number of teachers *",-1),de={key:0,class:"text-red"},ae={class:"q-mt-sm"},me={class:"q-my-xs"},ue=o("div",{class:"form-lable"},"Number of labs *",-1),_e={class:"col-md-6 col-xs-12 q-pa-sm"},ce={class:"q-my-xs"},fe=o("div",{class:"form-lable"},"Number of teachers toilets *",-1),he={key:0,class:"text-red"},be={class:"q-my-xs"},pe=o("div",{class:"form-lable"},"Gender *",-1),ve={key:0,class:"text-red"},ye={class:"q-my-xs"},Ve=o("div",{class:"form-lable"},"Number of girls toilets *",-1),ge={class:"q-my-xs"},qe=o("div",{class:"form-lable"},"Number of boys toilets *",-1),xe={class:"q-ma-sm"},we=o("div",{class:"text-center text-subtitle2"},"Water source",-1),Se={class:""},ke={class:"q-my-xs"},Ne=o("div",{class:"form-lable"},"Types of water sources *",-1),Ue={class:"q-ma-md"},He=o("div",{class:"text-center text-subtitle2"},"Desks, lockers and chairs",-1),Me={class:"q-my-sm"},Ee=o("div",{class:"form-lable"},"Number of desks *",-1),Be={class:"q-my-sm"},Oe=o("div",{class:"form-lable"},"Number of lockers *",-1),Qe={class:"q-my-sm"},je=o("div",{class:"form-lable"},"Number of chairs *",-1),Je={class:"flex justify-between q-ma-md"};function Pe(l,e,a,t,s,i){var v,V,g,q,x,w,S,k,N,U,H,M;return m(),u("div",Z,[z,o("form",{onSubmit:e[16]||(e[16]=C((...r)=>i.submit&&i.submit(...r),["prevent"]))},[o("div",F,[o("div",K,[o("div",X,[Y,n(y,{dense:"",outlined:"",modelValue:s.form.school,"onUpdate:modelValue":e[0]||(e[0]=r=>s.form.school=r),options:i.PrimarySchools,"popup-content-class":"selection-options"},null,8,["modelValue","options"]),(v=t.v$.form)!=null&&v.school.$error?(m(),u("div",$,f((V=t.v$.form)==null?void 0:V.school.$errors[0].$message),1)):h("",!0)]),o("div",ee,[se,n(d,{dense:"",outlined:"",modelValue:s.form.number_of_classes,"onUpdate:modelValue":e[1]||(e[1]=r=>s.form.number_of_classes=r),type:"number"},null,8,["modelValue"]),(g=t.v$.form)!=null&&g.number_of_classes.$error?(m(),u("div",oe,f((q=t.v$.form)==null?void 0:q.number_of_classes.$errors[0].$message),1)):h("",!0)]),o("div",re,[te,n(d,{dense:"",outlined:"",modelValue:s.form.number_of_students_per_class,"onUpdate:modelValue":e[2]||(e[2]=r=>s.form.number_of_students_per_class=r),type:"number"},null,8,["modelValue"]),(x=t.v$.form)!=null&&x.number_of_students_per_class.$error?(m(),u("div",le,f((w=t.v$.form)==null?void 0:w.number_of_students_per_class.$errors[0].$message),1)):h("",!0)]),o("div",ne,[ie,n(d,{dense:"",outlined:"",modelValue:s.form.number_of_teachers,"onUpdate:modelValue":e[3]||(e[3]=r=>s.form.number_of_teachers=r),type:"number"},null,8,["modelValue"]),(S=t.v$.form)!=null&&S.number_of_teachers.$error?(m(),u("div",de,f((k=t.v$.form)==null?void 0:k.number_of_teachers.$errors[0].$message),1)):h("",!0)]),o("div",ae,[n(B,{dense:"",outlined:"",modelValue:s.form.school_has_labs,"onUpdate:modelValue":[e[4]||(e[4]=r=>s.form.school_has_labs=r),i.handleSchoolHasLab],label:"School has lab(s)"},null,8,["modelValue","onUpdate:modelValue"])]),b(o("div",me,[ue,n(d,{dense:"",outlined:"",modelValue:s.form.number_of_labs,"onUpdate:modelValue":e[5]||(e[5]=r=>s.form.number_of_labs=r),type:"number"},null,8,["modelValue"])],512),[[p,s.form.school_has_labs]])]),o("div",_e,[o("div",ce,[fe,n(d,{dense:"",outlined:"",modelValue:s.form.number_of_teachers_toilets,"onUpdate:modelValue":e[6]||(e[6]=r=>s.form.number_of_teachers_toilets=r),type:"number"},null,8,["modelValue"]),(N=t.v$.form)!=null&&N.number_of_teachers_toilets.$error?(m(),u("div",he,f((U=t.v$.form)==null?void 0:U.number_of_teachers_toilets.$errors[0].$message),1)):h("",!0)]),o("div",be,[pe,n(y,{dense:"",outlined:"",modelValue:s.form.student_gender,"onUpdate:modelValue":e[7]||(e[7]=r=>s.form.student_gender=r),options:["boys","girls","mixed"],"popup-content-class":"selection-options"},null,8,["modelValue"]),(H=t.v$.form)!=null&&H.student_gender.$error?(m(),u("div",ve,f((M=t.v$.form)==null?void 0:M.student_gender.$errors[0].$message),1)):h("",!0)]),b(o("div",ye,[Ve,n(d,{dense:"",outlined:"",modelValue:s.form.number_of_girls_toilets,"onUpdate:modelValue":e[8]||(e[8]=r=>s.form.number_of_girls_toilets=r),type:"number"},null,8,["modelValue"])],512),[[p,i.schoolHasGirls]]),b(o("div",ge,[qe,n(d,{dense:"",outlined:"",modelValue:s.form.number_of_boys_toilets,"onUpdate:modelValue":e[9]||(e[9]=r=>s.form.number_of_boys_toilets=r),type:"number"},null,8,["modelValue"])],512),[[p,i.schoolHasBoys]])])]),o("div",xe,[we,o("div",Se,[n(B,{dense:"",outlined:"",modelValue:s.form.school_has_water_source,"onUpdate:modelValue":[e[10]||(e[10]=r=>s.form.school_has_water_source=r),i.handleSchoolHasWaterSource],label:"School has water source"},null,8,["modelValue","onUpdate:modelValue"])]),b(o("div",ke,[Ne,n(y,{dense:"",outlined:"",modelValue:s.form.types_of_water_sources,"onUpdate:modelValue":e[11]||(e[11]=r=>s.form.types_of_water_sources=r),"use-input":"","use-chips":"",multiple:"",options:i.waterSources,"popup-content-class":"selection-options"},null,8,["modelValue","options"])],512),[[p,s.form.school_has_water_source]])]),o("div",Ue,[He,o("div",Me,[Ee,n(d,{dense:"",outlined:"",modelValue:s.form.number_of_desks,"onUpdate:modelValue":e[12]||(e[12]=r=>s.form.number_of_desks=r),type:"number"},null,8,["modelValue"])]),o("div",Be,[Oe,n(d,{dense:"",outlined:"",modelValue:s.form.number_of_lockers,"onUpdate:modelValue":e[13]||(e[13]=r=>s.form.number_of_lockers=r),type:"number"},null,8,["modelValue"])]),o("div",Qe,[je,n(d,{dense:"",outlined:"",modelValue:s.form.number_of_chairs,"onUpdate:modelValue":e[14]||(e[14]=r=>s.form.number_of_chairs=r),type:"number"},null,8,["modelValue"])])]),o("div",Je,[n(O,{outline:"",label:"back",onClick:e[15]||(e[15]=r=>l.$router.go(-1)),"no-caps":""}),n(O,{outline:"",label:"submit",type:"submit","no-caps":""})])],32)])}var Ke=J(R,[["render",Pe]]);export{Ke as default};
