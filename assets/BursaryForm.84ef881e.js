import{_ as D,Z as R,$ as A,a6 as q,aa as E,a8 as T,a0 as V,a1 as v,a2 as w,J as m,af as h,ad as o,ak as j,d as n,ah as F,ai as d,a5 as I,a3 as u,b2 as r,ae as f,aj as N,b3 as P,b4 as L}from"./index.bacfec48.js";import{V as O}from"./vue3-pdf-embed.89cb2843.js";import{u as J}from"./index.91f2720f.js";import{c as Q}from"./index.e03e1fb1.js";import{g,r as U,p as W}from"./generateHeaders.c61a8e24.js";import{u as M}from"./auth_user_store.fb6dbab9.js";import"./axios.a3b240ae.js";R(M());const H={setup(){return{v$:J()}},data(){return{upload_new_bursary_form:!1,form:{description:""},selected_file:null,uploaded_file_details:"",pdf_source:"",scale:2,page:1,pageCount:1,show_all_pages:!1}},validations(){return{selected_file:{required:Q.withMessage("Bursary application form is required",t=>!!t)}}},computed:{},components:{Uploader:A(()=>q(()=>import("./Uploader.4dedb271.js"),["assets/Uploader.4dedb271.js","assets/index.bacfec48.js","assets/index.dc4e4c7b.css"])),VuePdfEmbed:O},mounted(){this.getBursary()},methods:{handleSelectedFile(t){this.selected_file=t},async submit(){try{if(this.v$.$touch(),this.v$.$error)return;const t=new FormData;t.append("description",this.form.description),t.append("bursary_form",this.selected_file.file);let c=(await this.$api.post("/api/v1/admin/bursary-form/upload/",t,{headers:{...g(),"Content-Type":"multipart/form-data"}})).data;const{message:l,success:e,results:a}=c;this.$router.go(-1)}catch(t){U({caller:"Application",error:t,api_encryption_enabled:this.api_encryption_enabled||!1})}},async getBursary(){try{let s=(await this.$api.get("/api/v1/admin/bursary-form/",{headers:{...g(),"Content-Type":"multipart/form-data"}})).data;const{message:c,success:l,results:e}=s;this.uploaded_file_details=e,e?(this.upload_new_bursary_form=!1,this.viewUploadedDocument()):this.upload_new_bursary_form=!0}catch(t){console.log("error fetching bursary form ",t)}},handleCancelBtn(){this.upload_new_bursary_form&&this.uploaded_file_details?this.upload_new_bursary_form=!1:this.$router.go(-1)},async viewUploadedDocument(){try{const t={file_path:this.uploaded_file_details.file_path},s=await this.$api.get("/api/v1/uploads/",{headers:{...g()},params:t,responseType:"blob"});let c=s.data;const l=new Blob([c],{type:s.headers.get("content-type")}),e=document.createElement("a");let a=await new Promise(_=>{let y=new FileReader;y.onload=_,y.readAsDataURL(l)}).then(_=>_.target.result);this.pdf_source=a,e.href=window.URL.createObjectURL(l)}catch(t){console.log("error fetching uploaded document ",t)}},handleDocumentRender(t){console.log(t),this.isLoading=!1,this.pageCount=this.$refs.pdfRef.pageCount},handleToggleShowAll(t){this.page=t?null:1},async updateApplicationWindowStatus(t){try{let s={application_window:t,id:this.uploaded_file_details.id};this.encryptionEnabled&&(s=E(JSON.stringify(s)));let l=(await this.$api.patch("/api/v1/admin/bursary-form/status/",s,{headers:{...g()}})).data;this.encryptionEnabled&&(l=JSON.parse(T(l)));const{message:e,success:a,results:_}=l;W({message:e}),this.getBursary()}catch(s){U({caller:"update application status",error:s,api_encryption_enabled:this.api_encryption_enabled})}}}},p=t=>(P("data-v-770ebb06"),t=t(),L(),t),Z={class:"flex flex-center main-page-height"},z={class:"form-container"},G=p(()=>o("div",{class:"text-center text-h6"},"Bursary application form",-1)),K={class:"q-my-sm"},X=p(()=>o("div",{class:""},"Description",-1)),Y={class:"q-my-sm"},$=p(()=>o("div",{class:""},"Pick file",-1)),ee={key:0,class:"text-red"},se={class:"flex justify-between"},te={class:"form-container",style:{"min-width":"80vw"}},oe=p(()=>o("div",{class:"text-center text-h6"},"Bursary application form",-1)),ae={class:"q-my-sm flex justify-center",style:{gap:"0px 10px"}},ie=p(()=>o("div",{class:""},"File name: ",-1)),le={class:""},ne={class:"q-my-sm flex justify-center items-center",style:{gap:"0px 10px"}},re=p(()=>o("div",{class:""},"Application window: ",-1)),de={class:""},pe={class:"q-my-sm"},ce=p(()=>o("div",{class:""},"Description",-1)),_e={class:""},ue={class:"flex justify-between q-pa-md"},fe={class:""},me={key:0},he={key:1},ye=["disabled"],ve=["disabled"],we={class:""},ge={class:"pdf-view-container"},be={class:"flex justify-between"};function Ce(t,s,c,l,e,a){var b,C,x,S,k,B;const _=V("Uploader"),y=V("vue-pdf-embed");return v(),w("div",Z,[m(o("div",z,[G,o("form",{class:"",onSubmit:s[1]||(s[1]=j((...i)=>a.submit&&a.submit(...i),["prevent"]))},[o("div",K,[X,n(F,{outlined:"",dense:"",modelValue:e.form.description,"onUpdate:modelValue":s[0]||(s[0]=i=>e.form.description=i),type:"textarea"},null,8,["modelValue"])]),o("div",Y,[$,n(_,{onSelected_file_emitted_event:a.handleSelectedFile},null,8,["onSelected_file_emitted_event"]),l.v$.selected_file.$error?(v(),w("div",ee,d(l.v$.selected_file.$errors[0].$message),1)):I("",!0)]),o("div",se,[n(f,{outline:"",color:"grey",onClick:a.handleCancelBtn,"no-caps":""},{default:u(()=>[r("Cancel")]),_:1},8,["onClick"]),n(f,{unelevated:"",color:"green",type:"submit","no-caps":""},{default:u(()=>[r("Submit")]),_:1})])],32)],512),[[h,e.upload_new_bursary_form]]),m(o("div",te,[oe,o("div",ae,[ie,o("div",le,d((b=e.uploaded_file_details)==null?void 0:b.file_name),1)]),o("div",ne,[re,o("div",de,[r(d((C=e.uploaded_file_details)==null?void 0:C.application_window)+" ",1),m(n(f,{unelevated:"",color:"green",dense:"","no-caps":"",onClick:s[2]||(s[2]=i=>a.updateApplicationWindowStatus("open"))},{default:u(()=>{var i;return[r(d(((i=e.uploaded_file_details)==null?void 0:i.application_window)==="closed"?"open application window":"close application window"),1)]}),_:1},512),[[h,((x=e.uploaded_file_details)==null?void 0:x.application_window)==="closed"]]),m(n(f,{unelevated:"",color:"red",dense:"","no-caps":"",onClick:s[3]||(s[3]=i=>a.updateApplicationWindowStatus("closed"))},{default:u(()=>[r(" close application window ")]),_:1},512),[[h,((S=e.uploaded_file_details)==null?void 0:S.application_window)==="open"]])])]),m(o("div",pe,[ce,o("div",_e,d((k=e.uploaded_file_details)==null?void 0:k.description),1)],512),[[h,(B=e.uploaded_file_details)==null?void 0:B.description]]),o("div",ue,[o("div",fe,[e.show_all_pages?(v(),w("span",me,d(e.pageCount)+" page(s) ",1)):(v(),w("span",he,[o("button",{disabled:e.page<=1,onClick:s[4]||(s[4]=i=>e.page--)},"\u276E",8,ye),r(" "+d(e.page)+" / "+d(e.pageCount)+" ",1),o("button",{disabled:e.page>=e.pageCount,onClick:s[5]||(s[5]=i=>e.page++)},"\u276F",8,ve)]))]),o("div",we,[o("label",null,[n(N,{modelValue:e.show_all_pages,"onUpdate:modelValue":[s[6]||(s[6]=i=>e.show_all_pages=i),a.handleToggleShowAll]},null,8,["modelValue","onUpdate:modelValue"]),r(" Show all ")])])]),o("div",ge,[n(y,{ref:"pdfRef",source:e.pdf_source,page:e.page,scale:e.scale,onRendered:a.handleDocumentRender},null,8,["source","page","scale","onRendered"])]),o("div",be,[n(f,{outline:"",color:"grey","no-caps":"",onClick:a.viewUploadedDocument},{default:u(()=>[r("view")]),_:1},8,["onClick"]),n(f,{unelevated:"",color:"green",onClick:s[7]||(s[7]=i=>e.upload_new_bursary_form=!0),"no-caps":""},{default:u(()=>[r("Change")]),_:1})])],512),[[h,!e.upload_new_bursary_form]])])}var Re=D(H,[["render",Ce],["__scopeId","data-v-770ebb06"]]);export{Re as default};
