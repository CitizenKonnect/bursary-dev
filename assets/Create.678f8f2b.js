import{_ as w,Z as q,$ as U,a6 as C,aa as E,a8 as k,a0 as M,a1 as d,a4 as N,a3 as m,ad as e,ak as B,d as n,a2 as u,ai as _,a5 as v,ah as g,ae as x,b2 as S}from"./index.58c24f9b.js";import{Q as T}from"./QPage.7b686137.js";import{u as A,g as P,r as Q}from"./generateHeaders.1afc8456.js";import{u as D}from"./index.0927d919.js";import{c as f,r as V}from"./index.2b518934.js";import{u as F}from"./auth_user_store.67764a02.js";import"./axios.5abb35e7.js";const{getSettings:O}=q(A()),{getAuthUserDetails:$}=q(F()),R={setup(){return{v$:D()}},data(){return{form:{from:null,to:null,sender_role:"",receiver_role:"",title:"test title",body:"some text for the body"},receiver:"",datetime:null,thread_id:null}},computed:{encryptionEnabled(){var t;return(t=O.value)==null?void 0:t.api_encryption_enabled}},components:{UsersFilter:U(()=>C(()=>import("./UsersFilter.a8d72c48.js"),["assets/UsersFilter.a8d72c48.js","assets/QItemLabel.e80a075a.js","assets/index.58c24f9b.js","assets/index.93ddf4f0.css","assets/QSelect.9a553155.js","assets/QMenu.635eb69f.js","assets/position-engine.3cd62232.js","assets/selection.0047419f.js","assets/format.a33550d6.js","assets/axios.5abb35e7.js","assets/generateHeaders.1afc8456.js","assets/auth_user_store.67764a02.js"]))},validations(){return{receiver:{required:f.withMessage("Receiver  is required",t=>!!t)},form:{title:{required:f.withMessage("Title is required",V)},body:{required:f.withMessage("Message is required",V)}}}},methods:{handleSelectedUser(t){this.receiver=t},clearSelection(){this.receiver=null},async submit(){var t,r;try{if(this.v$.$touch(),this.v$.$error)return;let a={...this.form,from:$.value.id,sender_role:$.value.role,to:(t=this.receiver)==null?void 0:t.id,receiver_role:(r=this.receiver)==null?void 0:r.role};this.encryptionEnabled&&(a=E(JSON.stringify(a)));let s=(await this.$api.post("/api/v1/communications/new/",a,{headers:{...P()}})).data;this.encryptionEnabled&&(s=JSON.parse(k(s)));const{message:i,success:p,results:c}=s}catch(a){Q({caller:"submit message",error:a,api_encryption_enabled:this.api_encryption_enabled})}}}},I={class:"form-container"},J=e("div",{class:"q-my-md"},[e("div",{class:"text-center"},"Enter title and body")],-1),j={class:"q-my-md"},H=e("div",{class:""},"Select user",-1),L={key:0,class:"text-red"},Z={class:"q-my-md"},z=e("div",{class:""},"Title",-1),G={key:0,class:"text-red"},K={class:"q-my-md"},W=e("div",{class:""},"Message ",-1),X={key:0,class:"text-red"},Y={class:"flex justify-between"};function ee(t,r,a,o,s,i){const p=M("UsersFilter");return d(),N(T,{class:"flex flex-center"},{default:m(()=>{var c,h,y,b;return[e("div",I,[J,e("form",{onSubmit:r[2]||(r[2]=B((...l)=>i.submit&&i.submit(...l),["prevent"]))},[e("div",j,[H,n(p,{onSelected_value_emitted:i.handleSelectedUser,onClear_selected_value:i.clearSelection},null,8,["onSelected_value_emitted","onClear_selected_value"]),o.v$.receiver.$error?(d(),u("div",L,_(o.v$.receiver.$errors[0].$message),1)):v("",!0)]),e("div",Z,[z,n(g,{outlined:"",modelValue:s.form.title,"onUpdate:modelValue":r[0]||(r[0]=l=>s.form.title=l),dense:""},null,8,["modelValue"]),(c=o.v$.form)!=null&&c.title.$error?(d(),u("div",G,_((h=o.v$.form)==null?void 0:h.title.$errors[0].$message),1)):v("",!0)]),e("div",K,[W,n(g,{outlined:"",modelValue:s.form.body,"onUpdate:modelValue":r[1]||(r[1]=l=>s.form.body=l),type:"textarea"},null,8,["modelValue"]),(y=o.v$.form)!=null&&y.body.$error?(d(),u("div",X,_((b=o.v$.form)==null?void 0:b.body.$errors[0].$message),1)):v("",!0)]),e("div",Y,[n(x,{color:"red",unelevated:"",outline:"","no-caps":"",style:{"min-width":"100px"}},{default:m(()=>[S("Cancel")]),_:1}),n(x,{color:"green",unelevated:"",type:"submit","no-caps":"",style:{"min-width":"100px"}},{default:m(()=>[S("Submit")]),_:1})])],32)])]}),_:1})}var ne=w(R,[["render",ee]]);export{ne as default};
